{# templates/partials/toasts_all.html #}
{% if messages %}
  <style>
    /* ===== Container centralizado logo abaixo da navbar fixa ===== */
    .toast-container-fixed{
      position: fixed;
      left: 50%;
      top: calc(var(--navbar-h, 64px) + .5rem);
      transform: translateX(-50%);
      z-index: 1080;
      max-width: 100vw;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: .5rem;
      pointer-events: none;            /* permite clicar no conteúdo atrás */
    }
    .toast-container-fixed .toast{ pointer-events: auto; }

    /* ===== Fallbacks locais (independentes do base.html) ===== */
    :root{
      --toast-max-width: 520px;
      --toast-font-size: 0.975rem;
      --toast-icon-size: 1.1rem;
      --toast-padding-y: .75rem;
      --toast-accent-w: 6px;      /* largura da faixa à esquerda */
      --toast-radius: .75rem;     /* raio dos cantos */
    }

    /* ===== Card do toast ===== */
    .toast.accent{
      position: relative;
      display: flex !important;
      overflow: hidden !important;          /* garante quinas limpas */
      width: min(100vw - 2rem, var(--toast-max-width)) !important;
      font-size: var(--toast-font-size);
      --bs-toast-padding-x: .75rem;
      padding-left: calc(var(--bs-toast-padding-x) + var(--toast-accent-w));
      border-radius: var(--toast-radius) !important;
      background-clip: padding-box;          /* garante borda limpa */
      border: 0 !important;                  /* remove borda fantasma */
    }

    /* ===== Faixa colorida à esquerda (acompanha cantos) ===== */
    .toast.accent::before{
      content: "";
      position: absolute;
      inset: 0 auto 0 0;
      width: var(--toast-accent-w);
      background: var(--accent, rgba(255,255,255,.35));
      opacity: .9;
      border-top-left-radius: inherit;
      border-bottom-left-radius: inherit;
      transform: translateZ(0);              /* evita aliasing */
    }

    /* ===== Corpo com quebra correta e sem “corte” ===== */
    .toast .toast-body{
      flex: 1 1 auto; min-width: 0;
      white-space: normal; overflow-wrap: anywhere;
      line-height: 1.35;
      padding-top: var(--toast-padding-y) !important;
      padding-bottom: var(--toast-padding-y) !important;
      padding-left: 0 !important; padding-right: 0 !important;
      margin-left: .5rem;
    }

    /* ===== Badge do ícone ===== */
    .toast-badge{
      width: 26px; height: 26px; border-radius: 50%;
      display: inline-flex; align-items: center; justify-content: center;
      margin: .35rem .25rem .35rem .25rem;
      background: rgba(255,255,255,.14);
      color: inherit;
      flex: 0 0 26px;
    }
    .toast-badge i{ font-size: var(--toast-icon-size) !important; }

    /* ===== Barra de progresso ===== */
    .toast .toast-progress{
      height: 3px; opacity: .35;
      border-bottom-left-radius: calc(var(--toast-radius) - 2px);
      border-bottom-right-radius: calc(var(--toast-radius) - 2px);
      animation: toastProgress var(--toast-delay, 4000ms) linear forwards;
      background: rgba(255,255,255,.9);
    }
    .bg-warning .toast-progress, .bg-info .toast-progress { background: rgba(0,0,0,.35); }

    @keyframes toastProgress { from { width: 100%; } to { width: 0%; } }
    @media (prefers-reduced-motion: reduce){
      .toast .toast-progress { animation: none; width: 0; }
    }
  </style>

  <div class="toast-container-fixed">
    {% for message in messages %}
      {% if 'no_toast' not in message.tags %}
        {% with level=message.level_tag %}
          {# === ERROR / DANGER === #}
          {% if level == 'error' or level == 'danger' %}
            {% with tag='danger' delay=8000 icon='x-circle' textclass='text-white' btnclass='btn-close-white' aria='assertive' %}
              <div class="toast accent shadow-lg border-0 bg-{{ tag }} {{ textclass }}"
                   role="alert" aria-live="{{ aria }}" aria-atomic="true"
                   data-bs-delay="{{ delay }}" data-bs-autohide="true"
                   style="--accent: var(--bs-{{ tag }}); --toast-delay: {{ delay }}ms;">
                <div class="d-flex align-items-center w-100">
                  <div class="toast-badge"><i class="bi bi-{{ icon }}"></i></div>
                  <div class="toast-body py-2">
                    {{ message }}
                    <div class="toast-progress mt-1"></div>
                  </div>
                  <button type="button" class="btn-close {{ btnclass }} ms-3 me-2 align-self-center"
                          data-bs-dismiss="toast" aria-label="Fechar"></button>
                </div>
              </div>
            {% endwith %}

          {# === WARNING === #}
          {% elif level == 'warning' %}
            {% with tag='warning' delay=6000 icon='exclamation-triangle' textclass='text-dark' btnclass='' aria='polite' %}
              <div class="toast accent shadow-lg border-0 bg-{{ tag }} {{ textclass }}"
                   role="alert" aria-live="{{ aria }}" aria-atomic="true"
                   data-bs-delay="{{ delay }}"
                   style="--accent: var(--bs-{{ tag }}); --toast-delay: {{ delay }}ms;">
                <div class="d-flex align-items-center w-100">
                  <div class="toast-badge"><i class="bi bi-{{ icon }}"></i></div>
                  <div class="toast-body py-2">
                    {{ message }}
                    <div class="toast-progress mt-1"></div>
                  </div>
                  <button type="button" class="btn-close {{ btnclass }} ms-3 me-2 align-self-center"
                          data-bs-dismiss="toast" aria-label="Fechar"></button>
                </div>
              </div>
            {% endwith %}

          {# === INFO === #}
          {% elif level == 'info' %}
            {% with tag='info' delay=4500 icon='info-circle' textclass='text-dark' btnclass='' aria='polite' %}
              <div class="toast accent shadow-lg border-0 bg-{{ tag }} {{ textclass }}"
                   role="alert" aria-live="{{ aria }}" aria-atomic="true"
                   data-bs-delay="{{ delay }}"
                   style="--accent: var(--bs-{{ tag }}); --toast-delay: {{ delay }}ms;">
                <div class="d-flex align-items-center w-100">
                  <div class="toast-badge"><i class="bi bi-{{ icon }}"></i></div>
                  <div class="toast-body py-2">
                    {{ message }}
                    <div class="toast-progress mt-1"></div>
                  </div>
                  <button type="button" class="btn-close {{ btnclass }} ms-3 me-2 align-self-center"
                          data-bs-dismiss="toast" aria-label="Fechar"></button>
                </div>
              </div>
            {% endwith %}

          {# === SUCCESS === #}
          {% else %}
            {% with tag='success' delay=4000 icon='check-circle' textclass='text-white' btnclass='btn-close-white' aria='polite' %}
              <div class="toast accent shadow-lg border-0 bg-{{ tag }} {{ textclass }}"
                   role="alert" aria-live="{{ aria }}" aria-atomic="true"
                   data-bs-delay="{{ delay }}"
                   style="--accent: var(--bs-{{ tag }}); --toast-delay: {{ delay }}ms;">
                <div class="d-flex align-items-center w-100">
                  <div class="toast-badge"><i class="bi bi-{{ icon }}"></i></div>
                  <div class="toast-body py-2">
                    {{ message }}
                    <div class="toast-progress mt-1"></div>
                  </div>
                  <button type="button" class="btn-close {{ btnclass }} ms-3 me-2 align-self-center"
                          data-bs-dismiss="toast" aria-label="Fechar"></button>
                </div>
              </div>
            {% endwith %}
          {% endif %}
        {% endwith %}
      {% endif %}
    {% endfor %}
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.toast').forEach(function (el) {
        new bootstrap.Toast(el).show();
      });
    });
  </script>
{% endif %}
